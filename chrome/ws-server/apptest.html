<html>
<head>
  <title>GenericApi Test</title>
  <script src="uuid-random.min.js"></script>
  <script src="hybridge_key.js"></script>
  <script src="hybridge.js"></script>
  <script src="app_web.js"></script>
  <script src="utils.js"></script>
  <style>
    .tab {
    border-collapse: collapse;
    }
    .tab td, th {
    padding: 8px;
    }

    .tab td {
    border: 1px solid gray;
    }

    div#track {
    margin: 4px;
    padding: 4px;
    text-align: center;
    background-color: orange;
    }
  </style>
</head>
<body>
<div>
  <h1>GenericApi Test</h1>
  <table class="tab">
    <tr><th>ext-app linked</th>
      <td colspan=2 id="ext_app_linked"><div id="track">0</div></td>
      </tr>
    <tr><th>from hybridge</th>
      <td id="arg-a"></td>
      <td id="arg-b"></td>
    </tr>
    <tr>
      <th>to hybridge</th>
      <td><input type="text" id="to-hybridge-txt"></td>
      <td><button id="to-hybridge-btn" type="button">TO HYBRIDGE</button></td>
    </tr>
  </table>
  <div id="results">
  </div>
</div>
</body>
<script>
var app_web;

window.onload = function window_onload() {
    app_web = new AppWeb('apptest');
    var num_errors = 0;

    document.getElementById("to-hybridge-btn").addEventListener(
        "click",
        function() {
            console.log('send msg');
            var arg = document.getElementById("to-hybridge-txt").value;
            var uu = app_web.send({'command': 'ext_app_open', 'args': [arg]},
                                  on_cmd_cb);
            console.log("FIRED CMD WITH UUID: " + uu);
        }
    );

    var time_cur = 0;
    var time_delta = 500;

    setTimeout(function(){
        var expected = {"content":null,"reason":"ok","ret":0};
        function check_expected(uu, msg) {
            custom_on_cmd_cb(uu, msg, expected);
        }
        var cmd = {'command': 'ext_app_open', 'args': ['Testing']};
        var uu = app_web.send(cmd, check_expected);
        custom_on_cmd_cb(uu, cmd);
    }, time_cur);

    time_cur += time_delta;
    setTimeout(function(){
        var expected = {"content":null,"reason":"ok","ret":0};
        function check_expected(uu, msg) {
            custom_on_cmd_cb(uu, msg, expected);
        }
        var cmd = {'command': 'notify_click', 'args': []};
        var uu = app_web.send(cmd, check_expected);
        custom_on_cmd_cb(uu, cmd);
    }, time_cur);

    time_cur += time_delta;
    setTimeout(function(){
        var expected = {"content":null,"reason":"ok","ret":0};
        function check_expected(uu, msg) {
            custom_on_cmd_cb(uu, msg, expected);
        }
        var cmd = {'command': 'info', 'args': ['Testing info message']};
        var uu = app_web.send(cmd, check_expected);
        custom_on_cmd_cb(uu, cmd);
    }, time_cur);

    time_cur += time_delta;
    setTimeout(function(){
        var expected = {"content":null,"reason":"ok","ret":0};
        function check_expected(uu, msg) {
            custom_on_cmd_cb(uu, msg, expected);
        }
        var cmd = {'command': 'warning', 'args': ['Testing warning message']};
        var uu = app_web.send(cmd, check_expected);
        custom_on_cmd_cb(uu, cmd);
    }, time_cur);

    time_cur += time_delta;
    setTimeout(function(){
        var expected = {"content":null,"reason":"ok","ret":0};
        function check_expected(uu, msg) {
            custom_on_cmd_cb(uu, msg, expected);
        }
        var cmd = {'command': 'error', 'args': ['Testing error message']};
        var uu = app_web.send(cmd, check_expected);
        custom_on_cmd_cb(uu, cmd);
    }, time_cur);

    time_cur += time_delta;
    // The following should not be allowed, because it's ipt-specific
    setTimeout(function(){
        var expected = {}
        function check_expected(uu, msg) {
            custom_on_cmd_cb(uu, msg, expected);
        }
        var cmd = {'command': 'ls_ipt_dir', 'args': []};
        var uu = app_web.send(cmd, check_expected);
        custom_on_cmd_cb(uu, cmd);
    }, time_cur);
}
</script>
</html>
